<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/controller/VehicleController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/controller/VehicleController.java" />
              <option name="originalContent" value="package CarRental.example.controller;&#10;&#10;import CarRental.example.document.Vehicle;&#10;import CarRental.example.document.Station;&#10;import CarRental.example.repository.VehicleRepository;&#10;import CarRental.example.repository.StationRepository;&#10;&#10;import org.springframework.web.bind.annotation.*;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.http.ResponseEntity;&#10;&#10;import java.util.List;&#10;import java.util.Optional;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/vehicles&quot;)&#10;@CrossOrigin(origins = &quot;*&quot;)&#10;public class VehicleController {&#10;&#10;    @Autowired&#10;    private VehicleRepository repo;&#10;&#10;    @Autowired&#10;    private StationRepository stationRepository;&#10;&#10;    @GetMapping(&quot;/station/{stationId}&quot;)&#10;    public List&lt;Vehicle&gt; getByStation(@PathVariable(&quot;stationId&quot;) String stationId) {&#10;        return repo.findByStationIdAndBookingStatusNot(stationId, &quot;RENTED&quot;);&#10;    }&#10;&#10;    @GetMapping(&quot;/staff/station/{stationId}&quot;)&#10;    public ResponseEntity&lt;?&gt; getByStation(@PathVariable(&quot;stationId&quot;) String stationId) {&#10;        try {&#10;            // Lấy danh sách xe tại trạm&#10;            List&lt;Vehicle&gt; vehicles = repo.findByStationIdAndBookingStatusNot(stationId, &quot;RENTED&quot;);&#10;&#10;            // Lấy thông tin trạm&#10;            Station station = stationRepository.findById(stationId).orElse(null);&#10;            String stationName = (station != null) ? station.getName() : &quot;Unknown Station&quot;;&#10;&#10;            // Tạo response object theo format frontend mong đợi&#10;            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();&#10;            response.put(&quot;stationName&quot;, stationName);&#10;            response.put(&quot;vehicles&quot;, vehicles);&#10;&#10;            return ResponseEntity.ok(response);&#10;        } catch (Exception e) {&#10;            return ResponseEntity.status(500).body(Map.of(&quot;error&quot;, &quot;Lỗi: &quot; + e.getMessage()));&#10;        }&#10;    }&#10;&#10;    @GetMapping(&quot;/admin/all&quot;)&#10;    public List&lt;Vehicle&gt; getAllVehicles() {&#10;        return repo.findAll();&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public Optional&lt;Vehicle&gt; getVehicle(@PathVariable(&quot;id&quot;) String id) {&#10;        return repo.findById(id);&#10;    }&#10;&#10;    @GetMapping(&quot;/admin/{id}&quot;)&#10;    public Optional&lt;Vehicle&gt; getVehicleById(@PathVariable(&quot;id&quot;) String id) {&#10;        return repo.findById(id);&#10;    }&#10;&#10;    @PostMapping(&quot;/admin/add&quot;)&#10;    public Vehicle addVehicle(@RequestBody Vehicle vehicle) {&#10;        return repo.save(vehicle);&#10;    }&#10;&#10;    @PutMapping(&quot;/admin/update/{id}&quot;)&#10;    public Vehicle updateVehicle(@PathVariable(&quot;id&quot;) String id, @RequestBody Vehicle updatedVehicle) {&#10;        updatedVehicle.setId(id);&#10;        return repo.save(updatedVehicle);&#10;    }&#10;&#10;    @DeleteMapping(&quot;/admin/delete/{id}&quot;)&#10;    public String deleteVehicle(@PathVariable(&quot;id&quot;) String id) {&#10;        repo.deleteById(id);&#10;        return &quot;Delete vehicle &quot; + id + &quot; success&quot;;&#10;    }&#10;}" />
              <option name="updatedContent" value="package CarRental.example.controller;&#10;&#10;import CarRental.example.document.Vehicle;&#10;import CarRental.example.document.Station;&#10;import CarRental.example.repository.VehicleRepository;&#10;import CarRental.example.repository.StationRepository;&#10;&#10;import org.springframework.web.bind.annotation.*;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.http.ResponseEntity;&#10;&#10;import java.util.List;&#10;import java.util.Optional;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/vehicles&quot;)&#10;@CrossOrigin(origins = &quot;*&quot;)&#10;public class VehicleController {&#10;&#10;    @Autowired&#10;    private VehicleRepository repo;&#10;&#10;    @Autowired&#10;    private StationRepository stationRepository;&#10;&#10;    // Endpoint cho trang đặt xe - trả về List&lt;Vehicle&gt;&#10;    @GetMapping(&quot;/station/{stationId}&quot;)&#10;    public List&lt;Vehicle&gt; getByStation(@PathVariable(&quot;stationId&quot;) String stationId) {&#10;        return repo.findByStationIdAndBookingStatusNot(stationId, &quot;RENTED&quot;);&#10;    }&#10;&#10;    // Endpoint cho staff page - trả về { stationName, vehicles }&#10;    @GetMapping(&quot;/station/{stationId}/staff-station&quot;)&#10;    public ResponseEntity&lt;?&gt; getByStationWithInfo(@PathVariable(&quot;stationId&quot;) String stationId) {&#10;        try {&#10;            // Lấy danh sách xe tại trạm&#10;            List&lt;Vehicle&gt; vehicles = repo.findByStationIdAndBookingStatusNot(stationId, &quot;RENTED&quot;);&#10;&#10;            // Lấy thông tin trạm&#10;            Station station = stationRepository.findById(stationId).orElse(null);&#10;            String stationName = (station != null) ? station.getName() : &quot;Unknown Station&quot;;&#10;&#10;            // Tạo response object theo format frontend mong đợi&#10;            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();&#10;            response.put(&quot;stationName&quot;, stationName);&#10;            response.put(&quot;vehicles&quot;, vehicles);&#10;&#10;            return ResponseEntity.ok(response);&#10;        } catch (Exception e) {&#10;            return ResponseEntity.status(500).body(Map.of(&quot;error&quot;, &quot;Lỗi: &quot; + e.getMessage()));&#10;        }&#10;    }&#10;&#10;    // ... existing code...&#10;    @GetMapping(&quot;/admin/all&quot;)&#10;    public List&lt;Vehicle&gt; getAllVehicles() {&#10;        return repo.findAll();&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public Optional&lt;Vehicle&gt; getVehicle(@PathVariable(&quot;id&quot;) String id) {&#10;        return repo.findById(id);&#10;    }&#10;&#10;    @GetMapping(&quot;/admin/{id}&quot;)&#10;    public Optional&lt;Vehicle&gt; getVehicleById(@PathVariable(&quot;id&quot;) String id) {&#10;        return repo.findById(id);&#10;    }&#10;&#10;    @PostMapping(&quot;/admin/add&quot;)&#10;    public Vehicle addVehicle(@RequestBody Vehicle vehicle) {&#10;        return repo.save(vehicle);&#10;    }&#10;&#10;    @PutMapping(&quot;/admin/update/{id}&quot;)&#10;    public Vehicle updateVehicle(@PathVariable(&quot;id&quot;) String id, @RequestBody Vehicle updatedVehicle) {&#10;        updatedVehicle.setId(id);&#10;        return repo.save(updatedVehicle);&#10;    }&#10;&#10;    @DeleteMapping(&quot;/admin/delete/{id}&quot;)&#10;    public String deleteVehicle(@PathVariable(&quot;id&quot;) String id) {&#10;        repo.deleteById(id);&#10;        return &quot;Delete vehicle &quot; + id + &quot; success&quot;;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/document/Staff.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/document/Staff.java" />
              <option name="originalContent" value="package CarRental.example.document;&#10;&#10;import org.springframework.data.mongodb.core.mapping.Document;&#10;&#10;@Document(collection = &quot;staff&quot;)&#10;public class Staff extends User {&#10;&#10;    private String stationId;&#10;&#10;    public Staff() {&#10;    }&#10;&#10;    public Staff(String stationId) {&#10;        this.stationId = stationId;&#10;    }&#10;&#10;    public String getStationId() {&#10;        return stationId;&#10;    }&#10;&#10;    public void setStationId(String stationId) {&#10;        this.stationId = stationId;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package CarRental.example.document;&#10;&#10;import org.springframework.data.mongodb.core.mapping.Document;&#10;&#10;@Document(collection = &quot;staff&quot;)&#10;public class Staff extends User {&#10;&#10;    private String stationId;&#10;&#10;    public Staff() {&#10;    }&#10;&#10;    public Staff(String stationId) {&#10;        this.stationId = stationId;&#10;    }&#10;&#10;    public String getStationId() {&#10;        return stationId;&#10;    }&#10;&#10;    public void setStationId(String stationId) {&#10;        this.stationId = stationId;&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/document/Vehicle.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/document/Vehicle.java" />
              <option name="originalContent" value="package CarRental.example.document;&#10;&#10;import org.springframework.data.annotation.Id;&#10;import org.springframework.data.mongodb.core.mapping.Document;&#10;&#10;@Document(collection = &quot;vehicles&quot;)&#10;public class Vehicle {&#10;&#10;    @Id&#10;    private String id;&#10;&#10;    private String plate;&#10;    private String type;&#10;    private String brand;&#10;    private int battery;&#10;    private double price;&#10;&#10;    private String stationId;&#10;    private boolean available = true;&#10;&#10;    // Booking lifecycle tracking&#10;    private String bookingStatus = &quot;AVAILABLE&quot;; // AVAILABLE, PENDING_PAYMENT, RENTED&#10;    private String pendingRentalId;&#10;&#10;    public String getId() { return id; }&#10;    public void setId(String id) { this.id = id; }&#10;&#10;    public String getPlate() { return plate; }&#10;    public void setPlate(String plate) { this.plate = plate; }&#10;&#10;    public String getType() { return type; }&#10;    public void setType(String type) { this.type = type; }&#10;&#10;    public String getBrand() { return brand; }&#10;    public void setBrand(String brand) { this.brand = brand; }&#10;&#10;&#10;    public int getBattery() { return battery; }&#10;    public void setBattery(int battery) { this.battery = battery; }&#10;&#10;    public double getPrice() { return price; }&#10;    public void setPrice(double price) { this.price = price; }&#10;&#10;    public String getStationId() { return stationId; }&#10;    public void setStationId(String stationId) { this.stationId = stationId; }&#10;&#10;    public boolean isAvailable() { return available; }&#10;    public void setAvailable(boolean available) { this.available = available; }&#10;&#10;    public String getBookingStatus() { return bookingStatus; }&#10;    public void setBookingStatus(String bookingStatus) { this.bookingStatus = bookingStatus; }&#10;&#10;    public String getPendingRentalId() { return pendingRentalId; }&#10;    public void setPendingRentalId(String pendingRentalId) { this.pendingRentalId = pendingRentalId; }&#10;}&#10;" />
              <option name="updatedContent" value="package CarRental.example.document;&#10;&#10;import org.springframework.data.annotation.Id;&#10;import org.springframework.data.mongodb.core.mapping.Document;&#10;&#10;@Document(collection = &quot;vehicles&quot;)&#10;public class Vehicle {&#10;&#10;    @Id&#10;    private String id;&#10;&#10;    private String plate;&#10;    private String type;&#10;    private String brand;&#10;    private int battery;&#10;    private double price;&#10;&#10;    private String stationId;&#10;    private boolean available = true;&#10;&#10;    // Booking lifecycle tracking&#10;    private String bookingStatus = &quot;AVAILABLE&quot;; // AVAILABLE, PENDING_PAYMENT, RENTED&#10;    private String pendingRentalId;&#10;&#10;    public String getId() { return id; }&#10;    public void setId(String id) { this.id = id; }&#10;&#10;    public String getPlate() { return plate; }&#10;    public void setPlate(String plate) { this.plate = plate; }&#10;&#10;    public String getType() { return type; }&#10;    public void setType(String type) { this.type = type; }&#10;&#10;    public String getBrand() { return brand; }&#10;    public void setBrand(String brand) { this.brand = brand; }&#10;&#10;    public int getBattery() { return battery; }&#10;    public void setBattery(int battery) { this.battery = battery; }&#10;&#10;    public double getPrice() { return price; }&#10;    public void setPrice(double price) { this.price = price; }&#10;&#10;    public String getStationId() { return stationId; }&#10;    public void setStationId(String stationId) { this.stationId = stationId; }&#10;&#10;    public boolean isAvailable() { return available; }&#10;    public void setAvailable(boolean available) { this.available = available; }&#10;&#10;    public String getBookingStatus() { return bookingStatus; }&#10;    public void setBookingStatus(String bookingStatus) { this.bookingStatus = bookingStatus; }&#10;&#10;    public String getPendingRentalId() { return pendingRentalId; }&#10;    public void setPendingRentalId(String pendingRentalId) { this.pendingRentalId = pendingRentalId; }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/static/js/staff-station-grid.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/static/js/staff-station-grid.js" />
              <option name="originalContent" value="document.addEventListener(&quot;DOMContentLoaded&quot;, function() {&#10;&#10;    const vehicleGrid = document.getElementById('vehicle-grid');&#10;&#10;    loadVehiclesForStation();&#10;&#10;    async function loadVehiclesForStation() {&#10;        try {&#10;            // =================================================================&#10;            // BACKEND CALL: GET /api/staff/my-station/vehicles (Giả định)&#10;            // Mục đích: Lấy danh sách xe TẠI TRẠM HIỆN TẠI của nhân viên.&#10;            // API này có thể DÙNG CHUNG với giao diện Dark Mode (staff-station-vehicles.js)&#10;            //&#10;            // Backend trả về:&#10;            // {&#10;            //   &quot;stationName&quot;: &quot;Q.1&quot;,&#10;            //   &quot;vehicles&quot;: [&#10;            //     { &quot;id&quot;: &quot;v1&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90,&#10;            //       &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //     { &quot;id&quot;: &quot;v2&quot;, &quot;plate&quot;: &quot;51C-678.90&quot;, &quot;model&quot;: &quot;VinFast Klara&quot;, &quot;battery&quot;: 45,&#10;            //       &quot;status&quot;: &quot;RENTED&quot;, &quot;statusText&quot;: &quot;Đang thuê&quot; },&#10;            //     { &quot;id&quot;: &quot;v3&quot;, &quot;plate&quot;: &quot;51D-111.22&quot;, &quot;model&quot;: &quot;VinFast Theon&quot;, &quot;battery&quot;: 30,&#10;            //       &quot;status&quot;: &quot;MAINTENANCE&quot;, &quot;statusText&quot;: &quot;Bảo trì&quot; }&#10;            //   ]&#10;            // }&#10;            // =================================================================&#10;&#10;            // --- GIẢ LẬP DỮ LIỆU ---&#10;            // const fakeData = {&#10;            //     stationName: &quot;Q.1&quot;,&#10;            //     vehicles: [&#10;            //         { &quot;id&quot;: &quot;v1&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v2&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;RENTED&quot;, &quot;statusText&quot;: &quot;Đang thuê&quot; },&#10;            //         { &quot;id&quot;: &quot;v3&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v4&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v5&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v6&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 30, &quot;status&quot;: &quot;MAINTENANCE&quot;, &quot;statusText&quot;: &quot;Bảo trì&quot; }&#10;            //     ]&#10;            // };&#10;            // const data = fakeData;&#10;            // --- KẾT THÚC GIẢ LẬP ---&#10;&#10;            // --- GỌI API LẤY DANH SÁCH XE TẠI TRẠM HIỆN TẠI ---&#10;            // Lấy stationId từ nhân viên hiện tại&#10;            console.log(&quot;Bước 1: Lấy thông tin trạm hiện tại...&quot;);&#10;            const stationResponse = await fetch('/api/staff/current-station');&#10;            console.log(&quot;Response station status:&quot;, stationResponse.status);&#10;            &#10;            if (!stationResponse.ok) {&#10;                const errorData = await stationResponse.text();&#10;                throw new Error(`Không thể lấy thông tin trạm (${stationResponse.status}): ${errorData}`);&#10;            }&#10;            &#10;            const stationData = await stationResponse.json();&#10;            console.log(&quot;Dữ liệu trạm:&quot;, stationData);&#10;            const stationId = stationData.id;&#10;            &#10;            if (!stationId) {&#10;                throw new Error('Không tìm thấy station ID');&#10;            }&#10;&#10;            // Lấy danh sách xe thuộc trạm này từ Vehicle Database&#10;            console.log(&quot;Bước 2: Lấy danh sách xe từ trạm:&quot;, stationId);&#10;            const vehicleResponse = await fetch(`/api/vehicles/station/${stationId}`);&#10;            console.log(&quot;Response vehicles status:&quot;, vehicleResponse.status);&#10;            &#10;            if (!vehicleResponse.ok) {&#10;                const errorData = await vehicleResponse.text();&#10;                throw new Error(`Không thể lấy danh sách xe (${vehicleResponse.status}): ${errorData}`);&#10;            }&#10;            &#10;            const data = await vehicleResponse.json();&#10;            console.log(&quot;Dữ liệu vehicles:&quot;, data);&#10;            &#10;            if (!data.vehicles || !Array.isArray(data.vehicles)) {&#10;                throw new Error('Format dữ liệu không đúng: vehicles phải là array');&#10;            }&#10;&#10;            vehicleGrid.innerHTML = '';&#10;            &#10;            // Helper function để format model&#10;            const formatModel = (vehicle) =&gt; {&#10;                return vehicle.model || `${vehicle.brand || ''} ${vehicle.type || ''}`.trim() || 'Unknown';&#10;            };&#10;            &#10;            // Helper function để format trạng thái&#10;            const formatStatus = (bookingStatus) =&gt; {&#10;                const statusMap = {&#10;                    'AVAILABLE': 'Sẵn sàng',&#10;                    'PENDING_PAYMENT': 'Chờ thanh toán',&#10;                    'RENTED': 'Đang thuê',&#10;                    'MAINTENANCE': 'Bảo trì',&#10;                    'CHARGING': 'Đang sạc'&#10;                };&#10;                return statusMap[bookingStatus] || bookingStatus;&#10;            };&#10;            &#10;            data.vehicles.forEach(vehicle =&gt; {&#10;                const card = document.createElement('div');&#10;                card.className = 'vehicle-card';&#10;                const batteryClass = vehicle.battery &lt; 40 ? 'low' : '';&#10;                let statusBadgeClass = 'badge-green'; // AVAILABLE&#10;                if (vehicle.bookingStatus === 'RENTED') statusBadgeClass = 'badge-orange';&#10;                else if (vehicle.bookingStatus === 'MAINTENANCE') statusBadgeClass = 'badge-red';&#10;                else if (vehicle.bookingStatus === 'CHARGING') statusBadgeClass = 'badge-blue';&#10;                else if (vehicle.bookingStatus === 'PENDING_PAYMENT') statusBadgeClass = 'badge-yellow';&#10;&#10;                const modelName = formatModel(vehicle);&#10;                const statusText = formatStatus(vehicle.bookingStatus);&#10;&#10;                card.innerHTML = `&#10;                    &lt;div class=&quot;card-header&quot;&gt;&#10;                        &lt;div class=&quot;plate&quot;&gt;${vehicle.plate || 'N/A'}&lt;/div&gt;&#10;                        &lt;div class=&quot;model&quot;&gt;${modelName}&lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;card-body&quot;&gt;&#10;                        &lt;div class=&quot;info-group&quot;&gt;&#10;                            &lt;label&gt;Mức pin&lt;/label&gt;&#10;                            &lt;div class=&quot;value battery-value ${batteryClass}&quot;&gt;${vehicle.battery || 0}%&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;info-group&quot;&gt;&#10;                            &lt;label&gt;Trạng thái&lt;/label&gt;&#10;                            &lt;span class=&quot;status-badge ${statusBadgeClass}&quot;&gt;${statusText}&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;card-footer&quot;&gt;&#10;                        &lt;button class=&quot;btn-card&quot; data-id=&quot;${vehicle.id}&quot; data-action=&quot;update&quot;&gt;Cập nhật&lt;/button&gt;&#10;                        &lt;button class=&quot;btn-card primary&quot; data-id=&quot;${vehicle.id}&quot; data-action=&quot;report&quot;&gt;Báo cáo sự cố&lt;/button&gt;&#10;                    &lt;/div&gt;&#10;                `;&#10;                vehicleGrid.appendChild(card);&#10;            });&#10;            &#10;            console.log(`Đã tải ${data.vehicles.length} xe thành công`);&#10;&#10;        } catch (error)&#10;        {&#10;            console.error(&quot;Lỗi tải danh sách xe:&quot;, error);&#10;            vehicleGrid.innerHTML = '&lt;p style=&quot;color: #e74c3c;&quot;&gt;Lỗi khi tải dữ liệu xe.&lt;/p&gt;';&#10;        }&#10;    }&#10;    vehicleGrid.addEventListener('click', (event) =&gt; {&#10;        const target = event.target;&#10;        if (target.tagName !== 'BUTTON' || !target.dataset.id) return;&#10;&#10;        const vehicleId = target.dataset.id;&#10;        const action = target.dataset.action;&#10;&#10;        if (action === 'update') {&#10;            // =================================================================&#10;            // BACKEND CALL: (Mở Modal)&#10;            // Mục đích: Mở 1 modal để nhân viên cập nhật pin/trạng thái.&#10;            // =================================================================&#10;            alert(`(Giả lập) Mở modal Cập nhật cho xe ID: ${vehicleId}`);&#10;        }&#10;        else if (action === 'report') {&#10;            // =================================================================&#10;            // BACKEND CALL: POST /api/staff/report-issue (Giả định)&#10;            // Mục đích: Báo cáo sự cố cho xe.&#10;            // =================================================================&#10;            const issue = prompt(`(Giả lập) Nhập sự cố cho xe ID: ${vehicleId}`);&#10;            if (issue) {&#10;                alert(`(Giả lập) Gửi báo cáo: &quot;${issue}&quot;`);&#10;            }&#10;        }&#10;    });&#10;&#10;});" />
              <option name="updatedContent" value="document.addEventListener(&quot;DOMContentLoaded&quot;, function() {&#10;&#10;    const vehicleGrid = document.getElementById('vehicle-grid');&#10;&#10;    loadVehiclesForStation();&#10;&#10;    async function loadVehiclesForStation() {&#10;        try {&#10;            // =================================================================&#10;            // BACKEND CALL: GET /api/staff/my-station/vehicles (Giả định)&#10;            // Mục đích: Lấy danh sách xe TẠI TRẠM HIỆN TẠI của nhân viên.&#10;            // API này có thể DÙNG CHUNG với giao diện Dark Mode (staff-station-vehicles.js)&#10;            //&#10;            // Backend trả về:&#10;            // {&#10;            //   &quot;stationName&quot;: &quot;Q.1&quot;,&#10;            //   &quot;vehicles&quot;: [&#10;            //     { &quot;id&quot;: &quot;v1&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90,&#10;            //       &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //     { &quot;id&quot;: &quot;v2&quot;, &quot;plate&quot;: &quot;51C-678.90&quot;, &quot;model&quot;: &quot;VinFast Klara&quot;, &quot;battery&quot;: 45,&#10;            //       &quot;status&quot;: &quot;RENTED&quot;, &quot;statusText&quot;: &quot;Đang thuê&quot; },&#10;            //     { &quot;id&quot;: &quot;v3&quot;, &quot;plate&quot;: &quot;51D-111.22&quot;, &quot;model&quot;: &quot;VinFast Theon&quot;, &quot;battery&quot;: 30,&#10;            //       &quot;status&quot;: &quot;MAINTENANCE&quot;, &quot;statusText&quot;: &quot;Bảo trì&quot; }&#10;            //   ]&#10;            // }&#10;            // =================================================================&#10;&#10;            // --- GIẢ LẬP DỮ LIỆU ---&#10;            // const fakeData = {&#10;            //     stationName: &quot;Q.1&quot;,&#10;            //     vehicles: [&#10;            //         { &quot;id&quot;: &quot;v1&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v2&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;RENTED&quot;, &quot;statusText&quot;: &quot;Đang thuê&quot; },&#10;            //         { &quot;id&quot;: &quot;v3&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v4&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v5&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 90, &quot;status&quot;: &quot;AVAILABLE&quot;, &quot;statusText&quot;: &quot;Sẵn sàng&quot; },&#10;            //         { &quot;id&quot;: &quot;v6&quot;, &quot;plate&quot;: &quot;51A-123.45&quot;, &quot;model&quot;: &quot;VinFast VFe34&quot;, &quot;battery&quot;: 30, &quot;status&quot;: &quot;MAINTENANCE&quot;, &quot;statusText&quot;: &quot;Bảo trì&quot; }&#10;            //     ]&#10;            // };&#10;            // const data = fakeData;&#10;            // --- KẾT THÚC GIẢ LẬP ---&#10;&#10;            // --- GỌI API LẤY DANH SÁCH XE TẠI TRẠM HIỆN TẠI ---&#10;            // Lấy stationId từ nhân viên hiện tại&#10;            console.log(&quot;Bước 1: Lấy thông tin trạm hiện tại...&quot;);&#10;            const stationResponse = await fetch('/api/staff/current-station');&#10;            console.log(&quot;Response station status:&quot;, stationResponse.status);&#10;            &#10;            if (!stationResponse.ok) {&#10;                const errorData = await stationResponse.text();&#10;                throw new Error(`Không thể lấy thông tin trạm (${stationResponse.status}): ${errorData}`);&#10;            }&#10;            &#10;            const stationData = await stationResponse.json();&#10;            console.log(&quot;Dữ liệu trạm:&quot;, stationData);&#10;            const stationId = stationData.id;&#10;            &#10;            if (!stationId) {&#10;                throw new Error('Không tìm thấy station ID');&#10;            }&#10;&#10;            // Lấy danh sách xe thuộc trạm này từ Vehicle Database&#10;            console.log(&quot;Bước 2: Lấy danh sách xe từ trạm:&quot;, stationId);&#10;            const vehicleResponse = await fetch(`/api/vehicles/station/${stationId}/staff-station`);&#10;            console.log(&quot;Response vehicles status:&quot;, vehicleResponse.status);&#10;            &#10;            if (!vehicleResponse.ok) {&#10;                const errorData = await vehicleResponse.text();&#10;                throw new Error(`Không thể lấy danh sách xe (${vehicleResponse.status}): ${errorData}`);&#10;            }&#10;            &#10;            const data = await vehicleResponse.json();&#10;            console.log(&quot;Dữ liệu vehicles:&quot;, data);&#10;            &#10;            if (!data.vehicles || !Array.isArray(data.vehicles)) {&#10;                throw new Error('Format dữ liệu không đúng: vehicles phải là array');&#10;            }&#10;&#10;            vehicleGrid.innerHTML = '';&#10;            &#10;            // Helper function để format model&#10;            const formatModel = (vehicle) =&gt; {&#10;                return vehicle.model || `${vehicle.brand || ''} ${vehicle.type || ''}`.trim() || 'Unknown';&#10;            };&#10;            &#10;            // Helper function để format trạng thái&#10;            const formatStatus = (bookingStatus) =&gt; {&#10;                const statusMap = {&#10;                    'AVAILABLE': 'Sẵn sàng',&#10;                    'PENDING_PAYMENT': 'Chờ thanh toán',&#10;                    'RENTED': 'Đang thuê',&#10;                    'MAINTENANCE': 'Bảo trì',&#10;                    'CHARGING': 'Đang sạc'&#10;                };&#10;                return statusMap[bookingStatus] || bookingStatus;&#10;            };&#10;            &#10;            data.vehicles.forEach(vehicle =&gt; {&#10;                const card = document.createElement('div');&#10;                card.className = 'vehicle-card';&#10;                const batteryClass = vehicle.battery &lt; 40 ? 'low' : '';&#10;                let statusBadgeClass = 'badge-green'; // AVAILABLE&#10;                if (vehicle.bookingStatus === 'RENTED') statusBadgeClass = 'badge-orange';&#10;                else if (vehicle.bookingStatus === 'MAINTENANCE') statusBadgeClass = 'badge-red';&#10;                else if (vehicle.bookingStatus === 'CHARGING') statusBadgeClass = 'badge-blue';&#10;                else if (vehicle.bookingStatus === 'PENDING_PAYMENT') statusBadgeClass = 'badge-yellow';&#10;&#10;                const modelName = formatModel(vehicle);&#10;                const statusText = formatStatus(vehicle.bookingStatus);&#10;&#10;                card.innerHTML = `&#10;                    &lt;div class=&quot;card-header&quot;&gt;&#10;                        &lt;div class=&quot;plate&quot;&gt;${vehicle.plate || 'N/A'}&lt;/div&gt;&#10;                        &lt;div class=&quot;model&quot;&gt;${modelName}&lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;card-body&quot;&gt;&#10;                        &lt;div class=&quot;info-group&quot;&gt;&#10;                            &lt;label&gt;Mức pin&lt;/label&gt;&#10;                            &lt;div class=&quot;value battery-value ${batteryClass}&quot;&gt;${vehicle.battery || 0}%&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &lt;div class=&quot;info-group&quot;&gt;&#10;                            &lt;label&gt;Trạng thái&lt;/label&gt;&#10;                            &lt;span class=&quot;status-badge ${statusBadgeClass}&quot;&gt;${statusText}&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;card-footer&quot;&gt;&#10;                        &lt;button class=&quot;btn-card&quot; data-id=&quot;${vehicle.id}&quot; data-action=&quot;update&quot;&gt;Cập nhật&lt;/button&gt;&#10;                        &lt;button class=&quot;btn-card primary&quot; data-id=&quot;${vehicle.id}&quot; data-action=&quot;report&quot;&gt;Báo cáo sự cố&lt;/button&gt;&#10;                    &lt;/div&gt;&#10;                `;&#10;                vehicleGrid.appendChild(card);&#10;            });&#10;            &#10;            console.log(`Đã tải ${data.vehicles.length} xe thành công`);&#10;&#10;        } catch (error)&#10;        {&#10;            console.error(&quot;Lỗi tải danh sách xe:&quot;, error);&#10;            vehicleGrid.innerHTML = '&lt;p style=&quot;color: #e74c3c;&quot;&gt;Lỗi khi tải dữ liệu xe.&lt;/p&gt;';&#10;        }&#10;    }&#10;    vehicleGrid.addEventListener('click', (event) =&gt; {&#10;        const target = event.target;&#10;        if (target.tagName !== 'BUTTON' || !target.dataset.id) return;&#10;&#10;        const vehicleId = target.dataset.id;&#10;        const action = target.dataset.action;&#10;&#10;        if (action === 'update') {&#10;            // =================================================================&#10;            // BACKEND CALL: (Mở Modal)&#10;            // Mục đích: Mở 1 modal để nhân viên cập nhật pin/trạng thái.&#10;            // =================================================================&#10;            alert(`(Giả lập) Mở modal Cập nhật cho xe ID: ${vehicleId}`);&#10;        }&#10;        else if (action === 'report') {&#10;            // =================================================================&#10;            // BACKEND CALL: POST /api/staff/report-issue (Giả định)&#10;            // Mục đích: Báo cáo sự cố cho xe.&#10;            // =================================================================&#10;            const issue = prompt(`(Giả lập) Nhập sự cố cho xe ID: ${vehicleId}`);&#10;            if (issue) {&#10;                alert(`(Giả lập) Gửi báo cáo: &quot;${issue}&quot;`);&#10;            }&#10;        }&#10;    });&#10;&#10;});" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>